(()=>{var v=e=>new Promise(t=>setTimeout(()=>t(),e)),y=new URL(window.location).searchParams;if(y.has("data")){let e=JSON.parse(window.atob(y.get("data")));document.getElementById("username").value=e.username,document.getElementById("submission").value=e.links}function p(){let e=new Date;document.getElementById("startdate").valueAsDate=new Date(e.getUTCFullYear(),e.getUTCMonth(),1)}p();async function w(){if(localStorage.getItem("auth")){let e=JSON.parse(localStorage.getItem("auth"));return e.toString=function(){return`z=${this.username}&y=${this.apikey}`},e}else return await I()}function I(){let t=document.getElementById("authModalTemplate").content.cloneNode(!0),c=t.children[0].querySelector("button");return document.body.appendChild(t),new Promise(s=>{c.addEventListener("click",l=>{let o=document.querySelector("div.authModal"),n={username:o.querySelector("input[name='username']").value,apikey:o.querySelector("input[name='apikey']").value,toString:function(){return`z=${this.username}&y=${this.apikey}`}};o.querySelector("input[name='saveinfo']").checked&&localStorage.setItem("auth",JSON.stringify(n)),document.body.removeChild(o),s(n)})})}document.getElementById("verify").addEventListener("click",async()=>{let e=await w(),t=document.getElementById("username"),c=document.getElementById("submission"),s=document.getElementById("startdate");if(s.value==""){s.style.backgroundColor="red",s.addEventListener("focus",()=>s.style.backgroundColor="revert",{once:!0});return}let l=Array.from(c.value.matchAll("https://(?:www.)?retroachievements.org/game/([0-9]+)")).map(([a,i])=>i),o=Array.from(c.value.matchAll("https://(?:www.)?retroachievements.org/achievement/([0-9]+)")).map(([a,i])=>i);m("output"),t.disabled=!0,s.disabled=!0,output.innerHTML=`
        <h1>Games</h1><hr />
        ${l.map(a=>`<div class="game">
            <div class="icon"></div>
            <a class="title" href="https://retroachievements.org/game/${a}">${a}</a>
            <span class="timestamp"></span>
            <div class="status">?</div>
        </div>`).join("")}

        <h1>Achievements</h1><hr />
        ${o.map(a=>`<div class="achievement">
            <div class="icon"></div>
            <a class="title" href="https://retroachievements.org/achievement/${a}">${a}</a>
            <span class="timestamp"></span>
            <div class="status">?</div>
        </div>`).join("")}
    `;let n=async(a,i)=>{let u=a.querySelector(".title").textContent,d=await i(e,t.value,u,s.valueAsDate),h=a.querySelector(".status");h.classList.add(...d.status.split(" ")),h.textContent=d.status.includes("success")?d.status.includes("alt")?"A":"\u2713":"X";let g=document.createElement("img");g.src=`https://media.retroachievements.org${d.icon}`,a.querySelector(".icon").appendChild(g),a.querySelector(".title").textContent=d.title,a.querySelector(".timestamp").textContent=d.timestamp},r=1e3;for(let a of output.querySelectorAll(".game"))await n(a,f),await v(r);for(let a of output.querySelectorAll(".achievement"))await n(a,A),await v(r);document.getElementById("username").disabled=!1,document.getElementById("startdate").disabled=!1});document.getElementById("clear").addEventListener("click",()=>{document.getElementById("username").value="",document.getElementById("submission").value="",document.getElementById("output").innerHTML="",document.getElementById("username").disabled=!1,document.getElementById("startdate").disabled=!1,m("submission")});document.getElementById("optionResetAuth").addEventListener("click",()=>{localStorage.removeItem("auth")});document.getElementById("optionCheckDate").addEventListener("change",e=>{let t=document.getElementById("startdate");e.target.checked?(t.disabled=!1,p()):(t.disabled=!0,t.valueAsDate=new Date(0))});for(let e of document.querySelectorAll("#tabs > div")){let t=e.dataset.target;e.addEventListener("mousedown",()=>{m(t)})}function m(e){document.getElementById(e).style.display="block";for(let t of document.querySelectorAll(`#content > :not(#${e})`))t.style.display="none";for(let t of document.querySelectorAll("#tabs > div"))t.classList.remove("selected"),t.dataset.target==e&&t.classList.add("selected")}async function f(e,t,c,s){let l=`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?${e}&u=${t}&g=${c}&a=1`,o=await fetch(l).then(u=>u.json()),n="failure";switch(o.HighestAwardKind){case"mastered":n="success mastered";break;case"beaten-hardcore":n="success";break;default:break}let r=new Date(o.HighestAwardDate);r<s&&(n="failure");let a=o.HighestAwardDate?r.toLocaleDateString():"",i=document.getElementById("altUsername").value;if(n=="failure"&&i.length){let u=await f(e,i,c,s);if(u.status.includes("success"))return u.status+=" alt",u}return{status:n,title:o.Title,icon:o.ImageIcon,timestamp:a}}async function A(e,t,c,s){let l=await fetch(`https://retroachievements.org/API/API_GetAchievementUnlocks.php?${e}&a=${c}&c=1`).then(a=>a.json()),n=(await fetch(`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?${e}&u=${t}&g=${l.Game.ID}&a=0`).then(a=>a.json())).Achievements[l.Achievement.ID],r="DateEarnedHardcore"in n?new Date(n.DateEarnedHardcore):null;return{status:r>s?"success":"failure",title:l.Achievement.Title,icon:`/Badge/${n.BadgeName}.png`,timestamp:r?r.toLocaleDateString():"N/A"}}})();
