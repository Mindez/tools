(()=>{var y=e=>new Promise(t=>setTimeout(()=>t(),e));function m(e,...t){let o="";for(let[r,n]of e.entries())o+=n,r in t&&(o+=t[r]);return o}var p=new URL(window.location).searchParams;if(p.has("data")){let e=JSON.parse(window.atob(p.get("data")));document.getElementById("username").value=e.username,document.getElementById("submission").value=e.links}function f(){let e=new Date;document.getElementById("startdate").valueAsDate=new Date(e.getUTCFullYear(),e.getUTCMonth(),1)}f();async function A(){if(localStorage.getItem("auth")){let e=JSON.parse(localStorage.getItem("auth"));return e.toString=function(){return`z=${this.username}&y=${this.apikey}`},e}else return await b()}function b(){let t=document.getElementById("authModalTemplate").content.cloneNode(!0),o=t.children[0].querySelector("button");return document.body.appendChild(t),new Promise(r=>{o.addEventListener("click",n=>{let c=document.querySelector("div.authModal"),s={username:c.querySelector("input[name='username']").value,apikey:c.querySelector("input[name='apikey']").value,toString:function(){return`z=${this.username}&y=${this.apikey}`}};c.querySelector("input[name='saveinfo']").checked&&localStorage.setItem("auth",JSON.stringify(s)),document.body.removeChild(c),r(s)})})}document.getElementById("verify").addEventListener("click",async()=>{let e=await A(),t=document.getElementById("username"),o=document.getElementById("altUsername"),r=document.getElementById("submission"),n=document.getElementById("startdate");if(n.value==""){n.style.backgroundColor="red",n.addEventListener("focus",()=>n.style.backgroundColor="revert",{once:!0});return}let c=Array.from(r.value.matchAll("https://(?:www.)?retroachievements.org/game/([0-9]+)")).map(([a,l])=>l),s=Array.from(r.value.matchAll("https://(?:www.)?retroachievements.org/achievement/([0-9]+)")).map(([a,l])=>l);h("output"),t.disabled=!0,o.disabled=!0,n.disabled=!0,output.innerHTML=m`<h1>Games</h1><hr />${c.map(a=>m`<div class="game"><div class="icon"></div><a class="title" href="https://retroachievements.org/game/${a}">${a}</a><span class="timestamp"></span><div class="status">?</div></div>`).join("")}<h1>Achievements</h1><hr />${s.map(a=>m`<div class="achievement"><div class="icon"></div><a class="title" href="https://retroachievements.org/achievement/${a}">${a}</a><span class="timestamp"></span><div class="status">?</div></div>`).join("")} `;let i=async(a,l)=>{let I=a.querySelector(".title").textContent,u=await l(e,t.value,I,n.valueAsDate),g=a.querySelector(".status");g.classList.add(...u.status.split(" ")),g.textContent=u.status.includes("success")?u.status.includes("alt")?"A":"\u2713":"X";let v=document.createElement("img");v.src=`https://media.retroachievements.org${u.icon}`,a.querySelector(".icon").appendChild(v),a.querySelector(".title").textContent=u.title,a.querySelector(".timestamp").textContent=u.timestamp},d=1e3;for(let a of output.querySelectorAll(".game"))await i(a,w),await y(d);for(let a of output.querySelectorAll(".achievement"))await i(a,E),await y(d);t.disabled=!1,o.disabled=!1,n.disabled=!1});document.getElementById("clear").addEventListener("click",()=>{document.getElementById("username").value="",document.getElementById("submission").value="",document.getElementById("output").innerHTML="",document.getElementById("username").disabled=!1,document.getElementById("startdate").disabled=!1,h("submission")});document.getElementById("optionResetAuth").addEventListener("click",()=>{localStorage.removeItem("auth")});document.getElementById("optionCheckDate").addEventListener("change",e=>{let t=document.getElementById("startdate");e.target.checked?(t.disabled=!1,f()):(t.disabled=!0,t.valueAsDate=new Date(0))});for(let e of document.querySelectorAll("#tabs > div")){let t=e.dataset.target;e.addEventListener("mousedown",()=>{h(t)})}function h(e){document.getElementById(e).style.display="block";for(let t of document.querySelectorAll(`#content > :not(#${e})`))t.style.display="none";for(let t of document.querySelectorAll("#tabs > div"))t.classList.remove("selected"),t.dataset.target==e&&t.classList.add("selected")}async function w(e,t,o,r){let n=`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?${e}&u=${t}&g=${o}&a=1`,c=await fetch(n).then(l=>l.json()),s="failure";switch(c.HighestAwardKind){case"mastered":s="success mastered";break;case"beaten-hardcore":s="success";break;default:break}let i=new Date(c.HighestAwardDate);i<r&&(s="failure");let d=c.HighestAwardDate?i.toLocaleDateString():"",a=document.getElementById("altUsername").value;if(t!=a&&a.length&&s=="failure"){let l=await w(e,a,o,r);if(l.status.includes("success"))return l.status+=" alt",l}return{status:s,title:c.Title,icon:c.ImageIcon,timestamp:d}}async function E(e,t,o,r){let n=await fetch(`https://retroachievements.org/API/API_GetAchievementUnlocks.php?${e}&a=${o}&c=1`).then(d=>d.json()),s=(await fetch(`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?${e}&u=${t}&g=${n.Game.ID}&a=0`).then(d=>d.json())).Achievements[n.Achievement.ID],i="DateEarnedHardcore"in s?new Date(s.DateEarnedHardcore):null;return{status:i>r?"success":"failure",title:n.Achievement.Title,icon:`/Badge/${s.BadgeName}.png`,timestamp:i?i.toLocaleDateString():"N/A"}}})();
